---
title: "Math158_Semesterproject_part3_MLR"
author: "Kevin Loun & Tesfa Asmara"
date: "4/3/2022"
output: pdf_document
---

```{r, include=FALSE}
library(magrittr) # needs to be run every time you start R and want to use %>%
library(dplyr)    # alternatively, this also loads %>%
library(tidyverse)
library(janitor)
library(ggridges)
library(ggplot2)
library(skimr)
library(broom)
knitr::opts_chunk$set(fig.pos="H", out.extra="")
library(patchwork)  # to get the plots next to one another
library(GGally)
library(recipes)
library(rsample)
library(parsnip)
library(workflows)
library(tidymodels)
```

# Introduction
  The dataset for this project contains 10,000 League of Legends ranked matches from the North American region with 775 variables offered through the Riot Games API, provided on Kaggle [@riot][@james_2020]. Each match is pulled from players who rank Gold in the League system, a ranking system that matches players of a similar skill level to play with and against each other. Amongst North American players, the Gold skill level was the second most common tier, achieved by 27.7 percent of players, or approximately 49.86 million players when considered against Riot Games' player base of 180 million [@statista_2021][@riot_tweet]. This dataset will be referred to as $\texttt{lol10}$.

  For this part of the project, the following variables are of interest: `lane`, `deaths`, `gold earned`, `player level` and `total damage dealt` with the goal of predicting the amount of `kills`a player recieves during a game.  A figure including all the relevant variables and their description is attached at the end.

```{r, echo=FALSE, include=FALSE}
#Import data and clean column names
lol10 <- read_csv('training_data.csv')
lol10 <- clean_names(lol10)
```

# Computational Model Building
```{r, echo=FALSE,include=FALSE}
#Initial Data Split
set.seed(123)
lol_split <- initial_split(lol10)
lol_train <- training(lol_split)
lol_test  <- testing(lol_split)
#clean_names(lol_train)
#Setting model/engine
lol_spec <- linear_reg() %>%
  set_engine("lm")
```
  Using computational model building, we developed two models containing some similar and different features with the goal of finding a model to best predict the number of `kills` players recieve in a game. To achieve this we split the data into a training and test set with the training set containing 75% of the initial data and the test set containing 25%.

```{r, echo=FALSE,include=FALSE}
# Generate gg plot of training data to find potential correlation
pairsplot <-lol_train %>%
 ggpairs(data=., columns = c('b_summoner1_kills','b_summoner1_total_damage_dealt','b_summoner1_gold_earned','b_summoner1_deaths','b_summoner1_lane','b_summoner1_level'),
columnLabels = c("Summoner Kills", "Total Damage Dealt","Gold Earned","Summoner Deaths","Summoner Lane","Summoner Level"))
pairsplot
```
## Feature Engineering
  Based on our knowledge of the dataset and variables we decided to create two recipes that would later develop into two models. In our first recipe we decided to add minimal features: removing zero variance predictors and converting categorical data into numerical binary variables. We choose these features so that we could convert our categorical variables into a format that could better contribute to our model and we remove zero variance predictors to remove any columns that could contain all zero values.
  
  In our second recipe we included the same features as recipe one as well as added additional features. In our second recipe we choos to include an interaction variable between `b_summoner1_total_damage_dealt` and `b_summoner1_gold_earned` because the total amount of gold a player recieves in game directly impacts the amount of damage they output due to increase the amount of items they are able to buy. We then chose to normalize and scale `b_summoner1_gold_earned` because of the vast difference in its range compared to other variables. Gold Earned ranged into the ten thousands while other variables ranged to 30, this could have given gold earned more weight in the model than other variables so it was scaled and normalized in order to avoid this. 

```{r echo=FALSE, include=FALSE}
#Features & Creating 3  recipes to clean data to needs & have to comparable models

##Recipe that only removes 0 variance predictors and creates dummy variables
lol_rec1 <- 
  recipe(b_summoner1_kills~game_id+b_summoner1_total_damage_dealt+b_summoner1_gold_earned+b_summoner1_deaths+b_summoner1_lane,data=lol_train)%>%
  update_role(game_id, new_role = "id")%>%
  step_dummy(all_nominal_predictors())%>%
  step_zv(all_predictors())

##Recipe that does the same as Recipe 1&2 and creates interaction variables between two variables that have a high correlation and normalizes & scales gold earned
lol_rec2 <- recipe(b_summoner1_kills~game_id+b_summoner1_total_damage_dealt+b_summoner1_gold_earned+b_summoner1_deaths+b_summoner1_lane+b_summoner1_level,data=lol_train)%>%
  update_role(game_id, new_role = "id")%>%
  step_dummy(all_nominal_predictors())%>%
  step_zv(all_predictors())%>%
  step_interact(terms=~b_summoner1_total_damage_dealt:b_summoner1_gold_earned)%>%
  step_normalize(b_summoner1_gold_earned)


#Creating Workflows
lol_wflow1 <- workflow() %>%
  add_model(lol_spec) %>%
  add_recipe(lol_rec1)

lol_wflow2 <- workflow() %>%
  add_model(lol_spec) %>%
  add_recipe(lol_rec2)

#Fitting the data
lol_fit1 <- lol_wflow1 %>%
  fit(data = lol_train)
lol_fit1%>%tidy()
lol_fit1%>%glance()

lol_fit2 <- lol_wflow2 %>%
  fit(data = lol_train)
lol_fit2%>%tidy()
lol_fit2%>%glance()
```

## Cross Validation and Fitting Model

```{r,echo=FALSE}
#Cross Validation with 5 Folds
set.seed(47)
folds <- vfold_cv(lol_train, v = 5)

lol_fit_rs1 <- lol_wflow1 %>%
  fit_resamples(folds)
collect_metrics(lol_fit_rs1)

lol_fit_rs2 <- lol_wflow2 %>%
  fit_resamples(folds)
collect_metrics(lol_fit_rs2)

```
## Fitting Model to Test Data
```{r, echo=FALSE}
#Predicting with Test data
lol_preds <- lol_wflow2 %>%
  fit(data = lol_train) %>%
  predict(lol_test) %>%
  bind_cols(lol_test %>% select(b_summoner1_kills)) 

lol_preds %>%
  rsq(truth = b_summoner1_kills, estimate = .pred)
lol_preds %>%
  rmse(truth = b_summoner1_kills, estimate = .pred)
```

# Statistical Model Building

