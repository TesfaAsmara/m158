---
title: "Math158_Semesterproject_part3_MLR"
author: "Kevin Loun & Tesfa Asmara"
date: "4/3/2022"
output: pdf_document
---

```{r, include=FALSE}
library(magrittr) # needs to be run every time you start R and want to use %>%
library(dplyr)    # alternatively, this also loads %>%
library(tidyverse)
library(janitor)
library(ggridges)
library(ggplot2)
library(skimr)
library(broom)
knitr::opts_chunk$set(fig.pos="H", out.extra="")
library(patchwork)  # to get the plots next to one another
library(GGally)
library(recipes)
library(rsample)
library(parsnip)
library(workflows)

```

# Introduction
The dataset for this project contains 10,000 League of Legends ranked matches from the North American region with 775 variables offered through the Riot Games API, provided on Kaggle [@riot][@james_2020]. Each match is pulled from players who rank Gold in the League system, a ranking system that matches players of a similar skill level to play with and against each other. Amongst North American players, the Gold skill level was the second most common tier, achieved by 27.7 percent of players, or approximately 49.86 million players when considered against Riot Games' player base of 180 million [@statista_2021][@riot_tweet]. This dataset will be referred to as $\texttt{lol10}$.

For this part of the project, the following variables are of interest: `lane`, `deaths`, `gold earned`, and `total damage dealt` with the goal of predicting the amount of `kills`a player recieves during a game. A figure including all the relevant variables and their description is attached at the end.

```{r, echo=FALSE}
#Import data and clean column names
lol10 <- read_csv('training_data.csv')
lol10 <- clean_names(lol10)
```

```{r, echo=FALSE}
#Initial Data Split
set.seed(123)
lol_split <- initial_split(lol10)
lol_train <- training(lol_split)
lol_test  <- testing(lol_split)
#clean_names(lol_train)
#Setting model/engine
lol_spec <- linear_reg() %>%
  set_engine("lm")

#Creating a 2 recipes to clean data to needs & have to comparable models

##Recipe that only removes 0 variance predictors and creates dummy variables
lol_rec1 <- 
  recipe(b_summoner1_kills~game_id+b_summoner1_total_damage_dealt+b_summoner1_gold_earned+b_summoner1_deaths+b_summoner1_lane,data=lol_train)%>%
  update_role(game_id, new_role = "id")%>%
  step_dummy(all_nominal_predictors())%>%
  step_zv(all_predictors())

##Recipe that does the same as Recipe 1 and creates interaction variables between two variables that have a high correlation
lol_rec2 <- recipe(b_summoner1_kills~game_id+b_summoner1_total_damage_dealt+b_summoner1_gold_earned+b_summoner1_deaths+b_summoner1_lane,data=lol_train)%>%
  update_role(game_id, new_role = "id")%>%
  step_dummy(all_nominal_predictors())%>%
  step_zv(all_predictors())%>%
  step_interact(terms=~b_summoner1_total_damage_dealt:b_summoner1_gold_earned)


#Creating Workflows
lol_wflow1 <- workflow() %>%
  add_model(lol_spec) %>%
  add_recipe(lol_rec1)

lol_wflow2 <- workflow() %>%
  add_model(lol_spec) %>%
  add_recipe(lol_rec2)

#Fitting the data
lol_fit1 <- lol_wflow1 %>%
  fit(data = lol_train)
lol_fit1%>%tidy()
lol_fit1%>%glance()

lol_fit2 <- lol_wflow2 %>%
  fit(data = lol_train)
lol_fit2%>%tidy()
lol_fit2%>%glance()

#Cross Validation with 5 Folds
set.seed(47)
folds <- vfold_cv(lol_train, v = 5)

lol_fit_rs1 <- lol_wflow1 %>%
  fit_resamples(folds)

lol_fit_rs2 <- lol_wflow2 %>%
  fit_resamples(folds)


```

```{r, echo=FALSE}
# Generate gg plot of training data to find potential correlation
pairsplot <-lol_train %>%
 ggpairs(data=., columns = c('b_summoner1_kills','b_summoner1_total_damage_dealt','b_summoner1_gold_earned','b_summoner1_deaths','b_summoner1_lane'),
columnLabels = c("Summoner Kills", "Total Damage Dealt","Gold Earned","Summoner Deaths","Summoner Lane"))
pairsplot
```